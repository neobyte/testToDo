<template>
    <div class="h-full flex flex-col bg-indigo-100 justify-between">

        <div class="bg-white p-6">
            <h1 class="text-indigo-700 sh p-10 font-semibold text-4xl">Manage your tasks</h1>

            <div class="m-4">
                <svg class="m-auto" width="67.55" height="100.48" enable-background="new -7.3901 -31.2657 1317.3901 1959.5686" version="1.1" viewBox="-7.3901 -31.266 67.55 100.48" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><metadata><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/><dc:title/></cc:Work></rdf:RDF></metadata>
                    <g transform="matrix(.053457 0 0 .053457 -8.432 -31.732)" fill="#00009f" fill-opacity=".57059" stroke-width="18.707">
                        <path d="m1114.8 11.79c6.35-2.36 13.63-4.52 20.23-1.82 6.1801 2.72 9.3101 9.55 9.74 15.98 1.12 13.78-3.6899 27.06-8.0699 39.89-17.59 48.39-25.08 99.57-32.9 150.23-14.19 94.54-28.16 189.35-52 282.05-10.94 42.86-24.02 85.14-37.87 127.13-13.35 38.97-27.3 77.75-42.95 115.86-7.59 18.44-15.34 36.86-24.32 54.68-7.53 14.97-17.55 28.65-23.73 44.29-9.28 21.55-13.6 45.53-10.55 68.9 2.22 19.67 8.79 39.08 20.37 55.24 8.16 11.46 19.05 20.95 31.52 27.48 19.6 10.44 41.74 14.95 63.66 17.23 42.27 4 84.81 0.22 126.8-4.97 36.78-4.75 73.37-11.04 109.48-19.47 6.3099-1.39 12.46-3.48 18.86-4.46-18.12 6.62-36.62 12.21-54.99 18.09-45.63 13.92-92.12 27.49-140.14 28.84-24.62 1.24-49.27-0.8199-73.73-3.52-26.46-3.17-52.79-7.64-78.69-13.92-16.15-4.13-32.96-8.39-46.38-18.76-5.24-4.53-10.28-9.57-13.3-15.88-5.66-10.73-7.06-22.98-8.25-34.87-0.41-6.67-0.13-13.38-0.85-20.03-0.47-15.11 0.04-30.24-0.59-45.34-0.9-7.16-0.68-14.39-0.84-21.59 0.04-6.9-1.14-13.78-0.51-20.69 0.4901-4.45 0.55-8.93 0.6801-13.4 1.28-21.27 6.75-42.08 14.38-61.91 7.19-19.09 15.6-37.68 23.6-56.43 39.52-91.48 68.21-187.39 89.09-284.75 12.27-56.84 22.45-114.1 32.66-171.34 4.24-25.08 9.23-50.13 10.74-75.57 0.06-2.8-0.71-5.5-1.3101-8.2-1.2899 0.27-2.7599 0.17-3.72 1.22-5.73 4.97-10.48 10.91-15.03 16.95-35.95 46.57-68.85 95.65-96.31 147.73-30.64 58.39-53.87 120.62-69.37 184.71-11.47 47.15-18.65 95.37-21.04 143.83-0.99 7.88-0.39 15.85-1.25 23.74-0.68 9.33-0.21 18.69-0.79 28.03-1 11.96-0.26 24-1.02 35.98-0.67 6.98-0.47 14.01-0.71 21.02-1.15 16.76-1.6 33.71-5.43 50.14-1.87 7.68-4.77 15.68-11.13 20.79-5.17 4.3199-12.65 3.89-18.71 1.94-10.93-4.13-20.17-11.54-29.05-18.96-8.45-6.83-16.14-14.55-24.54-21.44-3.64-3.73-7.23-7.54-11.43-10.65-8.1-7.96-16.98-15.1-26.24-21.67-10.79-7.54-23.14-13.15-36.27-14.87-15.94-2-32.01 0.52-47.56 3.99-18.43 4.07-36.54 9.5-54.48 15.34-24.9 8.49-49.59 17.88-72.94 30.06-15.61 8.12-30.07 18.26-43.76 29.26-13.02 10.34-25.96 21.41-41.75 27.31-40.56 15.58-85.66 10.8-126.42 25.62-11 4.34-21.98 10-29.82 19.09-14.02 12.14-21.29 30.12-25.12 47.87-4.09 19.72-5.75 39.84-9.57 59.61-8.53 47.34-29.79 90.98-51.2 133.61-10.83 21.64-22.14 43.04-33.38 64.47-10.54 20.9-21.04 41.82-31.44 62.79-9.24 18.37-18.05 36.96-27.84 55.05-3.13 6.0801-5.95 12.34-8.34 18.75-3.98 10.89-3.15 23.16 1.25 33.8 5.15 12.76 13.16 24.28 22.72 34.13 14.48 14.76 34.18 24.89 54.99 26.13 10.02 0.5599 19.71-3 28.35-7.79 12.39-6.85 23.63-15.55 34.76-24.23 19.17-15.12 37.78-30.92 56.73-46.29 11.7-9.3999 23.34-19 36.17-26.84 3.54-2.1899 7.35-4.15 11.58-4.4399 0.16 3.77-2.14 6.89-4.25 9.7899-11.03 14.8-24.87 27.12-37.57 40.42-4.24 4.02-7.63 8.96-12.55 12.23-3.58 2.4401-6.43 5.73-9.41 8.84-3.21 3.5-7.36 5.9601-10.58 9.4601-3.33 3.6799-7.43 6.53-10.95 10.01-6.02 6.3099-13.27 11.37-18.64 18.32-6.6 7.04-12.29 15.61-13.13 25.47-1.71 18.1 6.62 35.09 7.88 52.92 0.23 2.46-1.19 4.6-2.27 6.7-4.88-0.1899-8.5-3.7999-11.88-6.8999-8.96-8.7201-17.73-17.63-26.22-26.79-5.44-5.9301-11.74-10.96-17.4-16.66-11.04-8.7999-22.59-18.21-36.73-21.24-2.5-1.0499-5.77 1.08-5.33 3.88 0.61 5.73 3.25 11 5.28 16.34 7.65 17.89 16.44 35.27 25.15 52.67 5.27 9.97 10.06 20.25 16.47 29.57 4.38 6.3 10.36 12.19 18.16 13.72 7.42 1.25 14.99 0.1699 22.33-1.12 12.95-2.3401 25.89-5.02 39.06-5.6801 26.69-1.24 53.3 2.33 79.99 1.84 19.61-0.3999 39.37-3.3199 57.65-10.65 13.01-5.1101 25.01-12.49 36.09-20.95 15.42-11.75 30.51-24.1 47.53-33.53 16.67-9.5299 34.87-16.09 53.47-20.71 41.11-10.26 83.28-15.55 124.32-26.15 37.25-9.3199 73.3-23.55 106.68-42.56 29.15-16.68 56.4-37.12 78.82-62.25 28.52-31.59 48.52-70.09 61.48-110.44 2.97-7.75 4.28-16.21 8.47-23.43 0.96 10.34-0.34 20.73-1.75 30.98-5.98 39.22-21.51 77.04-45.36 108.78-23.28 31.09-52.02 57.73-82.96 81.05-30.62 23.1-64.16 42.61-100.26 55.77-21.52 8.15-43.86 13.84-65.61 21.3-13.25 4.51-25.91 10.7-37.6 18.39-17.6 11.37-33.82 24.9-52.41 34.71-17.76 9.5-37.06 15.68-56.5 20.66-30.32 7.58-61.38 12.25-92.59 13.85 2.57 13.57 3.82 27.36 6.69 40.89 6.99 36.65 20.54 71.81 38.16 104.63 25.57 47.42 56.05 91.95 87.01 135.97 2.5 3.77 5.66 7.25 6.99 11.68-5.93-4.2-10.2-10.22-15.26-15.35-27.09-29.85-53.71-60.39-75.87-94.15-20.96-31.93-36.58-66.89-52.63-101.42-7.63-16.42-15.5-32.74-22.48-49.44-3.99-9.6799-7.78-19.54-9.52-29.92-10.83 1.51-21.57 4.1899-32.57 4.1499-15.11-0.6299-29.8-5.3099-44.98-4.96-10.05-0.23-20 1.3301-29.99 2.03-9.6 0.38-19.32 0.58-28.76-1.5-21.6-4.4301-40.67-17.6-54.77-34.25-9.96-11.49-17.05-25.11-22.75-39.12-7.97-20.54-13.67-41.87-21.45-62.47-6.21-16.54-15.69-31.7-27.06-45.17-6.86-8.5699-14.38-16.8-19.19-26.77-4.46-8.66-5.6-18.82-3.57-28.3 2.81-13.98 10.34-26.38 18.13-38.1 10.82-16.07 22.53-31.53 33.28-47.65 23.69-35.2 43.06-73.44 56.05-113.88 15.86-48.51 19.12-99.82 30.65-149.32 4.29-18.06 10.88-35.53 19.47-51.97 8.37-14.77 18.28-28.6 29.1-41.66 21.45-26.19 45.69-51.42 76.56-66.38 32.22-15.33 68.26-18.65 102.08-28.99 17.57-5.41 34.47-12.81 50.74-21.32 2.43-1.21 4.69-2.68 6.95-4.17 0.01-7.76-0.98-15.48-0.74-23.24 0.18-10.33-0.4-20.68 0.45-30.98 0.48-16-0.1-32.03 1.1-48 0.29-11.03 0.09-22.07 1.06-33.06-0.04-14.02 1.27-27.97 1.39-41.98 1.04-8.62 0.48-17.34 1.36-25.97 2.3-48.67 5.37-97.3 9.61-145.85 4.23-45.27 9.1-90.59 18.28-135.16 8-38.4 19.85-76.43 39.43-110.6 9.63-16.84 20.79-32.84 33.66-47.36 11.99-13.13 25.12-25.6 40.89-34.08 15.27-8.68 33.19-12.75 50.7-10.75 13.77 1.08 27.15 6.48 37.65 15.48 14.08 12.03 24.02 27.99 32.92 44.03 18.18 33.86 31.07 70.19 43.77 106.37 7.05 20.84 14.48 41.61 19.91 62.95 21.73-30.63 44.84-60.29 69.71-88.45 44.89-50.96 93.21-98.83 143.48-144.47 28.77-25.72 57.9-51.21 89.35-73.66 11.81-8.2498 23.98-16.26 37.4-21.67m-512.26 126.9c-17.4 6.61-31.67 19.26-44.1 32.8-21.52 24.14-38.39 52.21-51.14 81.86-16.48 39.12-25.02 81-31.47 122.79-6.67 44.67-10.22 89.75-11.77 134.86-1.24 15.63-0.15 31.35-1.35 46.98-0.67 66.67 0.51 133.35-0.31 200.02-0.75 10.54-0.9 21.12-2.24 31.62 31.31-16.75 62.62-34.24 96.78-44.6 22.81-7.03 46.54-10.34 69.5-16.76 11.79-3.46 24.04-7.91 32.5-17.25 6.47-7.13 10.02-16.39 12.12-25.66 3.67-16.53 4.01-33.53 5-50.36 0.99-25.17 2.5-50.37 6.22-75.31 5.83-41.41 18.37-81.67 35.47-119.77 0.68-2.07 2.42-4.2 1.53-6.45-7.39-20.31-11.31-41.66-15.86-62.74-10.8-52.07-20.24-104.45-33.11-156.07-4.8-18.42-9.63-37-17.82-54.26-4.04-8.02-8.99-16.24-16.98-20.85-10-5.79-22.49-4.72-32.97-0.85z"/>
                        <path d="m588.43 928.68c27.64-3.91 56.78 0.69 81.01 14.89 10.37 5.95 19.99 13.14 29.21 20.73 3.39 3.02 7.37 6.09 8.54 10.7-0.46 3.15-3.43 4.96-6.05 6.23-5.8 2.68-12.49 4.06-17.11 8.8-5.23 5.42-7.75 12.7-10.28 19.64-6.05 17.36-10.74 35.53-20.82 51.14-11.65 18.37-30.99 31.34-52.04 36.37-20.31 4.8099-41.42 0.5199-60.85-6-17.63-6.1001-34.94-13.93-49.77-25.4-9.77-7.55-16.81-17.94-26.48-25.59-2.97-2.33-1.37-6.5099-0.08-9.3099 4.71-9.31 10.74-17.89 16.84-26.32 15.18-20.51 32.35-40.03 53.63-54.4 16.21-11.03 34.78-18.76 54.25-21.48z"/>
                    </g>
                </svg>
            </div>
            <input
                class="w-full h-14 text-xl border border-gray-200 p-2 rounded-xl outline-none shadow "
                autofocus
                placeholder="What's Cookin' Doc?"
                v-model="newTask"
                @keyup.enter="addNewTask"
            />

        </div>

        <div class="">

            <ul>
                <li v-for="(task, index) in availableTasks"
                    :key="task.id"
                    class="flex bg-white m-6 p-5 rounded-xl "
                    :class="[task.status ? 'text-gray-400': 'text-indigo-400']" >

                    <div class="inline-block mr-2" @click="toggleStatus(task)">
                        <i class="fa fa-2x"
                           :class="[task.status ? 'fa-check-square-o' : 'fa-square-o']"
                           aria-hidden="true"></i>
                    </div>

                    <div class="flex-grow">

                    <input type="text"
                                       v-model="task.name"
                                       class="outline-none w-full p-1 rounded "
                                       :class="[task.isEditable ? 'bg-indigo-100' : '', task.status ? ' line-through' : '']"

                                       :readonly="!task.isEditable"
                                       v-task-focus="task.isEditable"
                                       @keyup.esc="cancelEditing(task)"
                                       @blur="completeEditing(task)">

                    </div>

                    <div class="text-2xl ml-2">
                        <i class="fa fa-pencil-square-o"
                           @click="activateEditing(task)"
                           aria-hidden="true"></i>
                        &nbsp;
                        <i class="fa fa-trash"
                           aria-hidden="true"
                           @click="removeTask(task)"></i>
                    </div>

                </li>
            </ul>
        </div>

        <div class="flex inline-flex justify-between bg-indigo-500 text-white p-5 w-full flex-grow-0">
            <div @click="filterNone()"
                 class="px-2 py-1 border border-gray-400 rounded cursor-pointer">All</div>
            <div @click="filterCompleted()"
                 class="px-2 py-1 border border-gray-400 rounded cursor-pointer">Completed</div>
            <div @click="filterPending()"
                 class="px-2 py-1 border border-gray-400 rounded cursor-pointer">Pending</div>
            <div @click="clearCompleted()"
                 class="px-2 py-1 border border-gray-400 rounded cursor-pointer">Clear Completed</div>

        </div>
    </div>
</template>

<script>
export default {
    name: "App",

    data: function(){
        return {
            newTask: '',
            tasksList: [],
            temporaryTaskName: '',
            availableTasks: []
        }
    },

    methods: {
        addNewTask: function() {
            let text = this.newTask && this.newTask.trim();
            // var value = this.newTask && this.newTask.trim();
            if (text) {

                axios.post('/tasks', {'name': text, 'status': 0})
                    .then((response) => {
                        if(response.data.status === 'saved') {

                            this.tasksList.unshift(response.data.message);
                        }
                    })

                this.newTask = "";
            }
        },
        removeTask: function(task) {

            axios.delete(`/tasks/${task.id}`)
                .then( response => {
                    if(response.data.status === 'deleted') {
                        this.tasksList.splice(this.tasksList.indexOf(task), 1);
                    }
                }).catch(() => alert('something went wrong on deleting task'))
        },

        activateEditing: function(task) {
            task.isEditable = true;
            this.temporaryTaskName = task.name;
        },
        cancelEditing: function(task) {
            task.name = this.temporaryTaskName
            this.temporaryTaskName = '';
            task.isEditable = false;
        },
        completeEditing: function(task) {
            if(task.isEditable) {

                axios.put(`/tasks/${task.id}`, { 'name' : task.name.trim() } )

                this.temporaryTaskName = '';
                task.isEditable = false;
            }
        },
        filterCompleted(){
            this.availableTasks = this.tasksList.filter(function(task){
                return task.status;
            })
        },
        filterPending(){
            this.availableTasks = this.tasksList.filter(function(task){
                return !task.status;
            })
        },
        filterNone(){
            this.availableTasks = this.tasksList;
        },
        toggleStatus(task) {
            task.status = !task.status;
            axios.put(`/tasks/${task.id}`, { 'status' : task.status } )
        },
        clearCompleted() {
            axios.post(`/tasks/clear-completed`, {} )
                .then(
                    response => {
                        if(response.data.status === 'success') {
                            this.filterPending();
                            this.tasksList = this.availableTasks;
                        }
                    }
                )
        }
    },

    mounted() {
        axios.get('/tasks')
            .then( result => {
                if(result.data.status === 'success') {
                    this.tasksList = result.data.message.reverse();
                    this.availableTasks = this.tasksList
                }
            })
    },
    directives: {
        "task-focus": {
            updated(el, binding) {
                if (binding.value) {
                    el.focus();
                }
            }
        }
    }
}
</script>

<style scoped>

</style>
